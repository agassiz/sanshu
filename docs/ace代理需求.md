# 任务：为 Sou 工具配置添加 HTTP 代理功能

## 目标文件
`src/frontend/components/tools/SouConfig.vue`

## 功能需求

### 1. 后端代理配置集成
在 Sou 的 MCP 工具配置中添加 HTTP/HTTPS 代理支持，确保以下网络请求能够通过代理：
- ACE 接口文件上传（单文件上传）
- ACE 接口项目上传（批量文件上传）
- ACE 语义搜索查询接口
- 所有与 ACE 服务器的 HTTP/HTTPS 通信

**技术要求：**
- 代理配置需要持久化存储（保存到配置文件或本地存储）
- 支持启用/禁用代理的开关
- 代理格式支持：`http://host:port` 或 `https://host:port`
- 需要处理代理认证（如果需要用户名密码）

### 2. UI 代理配置功能模块

#### 2.1 代理自动检测功能
**检测目标端口列表：**
- 7890（Clash 默认端口）
- 7891（Clash 备用端口）
- 1080（SOCKS5 常用端口，需转换为 HTTP 代理）
- 10809（V2Ray 常用端口）
- 其他用户自定义端口

**检测逻辑流程：**
1. 并发检测所有目标端口的可用性（通过 TCP 连接测试或 HTTP 请求测试）
2. 根据检测结果执行不同策略：
   - **检测到 0 个可用代理**：显示提示"未检测到本地代理，请手动输入代理地址"
   - **检测到 1 个可用代理**：自动填充到代理地址输入框，并显示提示："已自动检测到本地代理 [http://127.0.0.1:端口]，建议进行测速验证后再启用"
   - **检测到多个可用代理**：弹出选择器对话框，展示所有可用代理列表（显示地址、端口、响应时间），让用户选择一个
3. 用户可以随时手动修改或输入自定义代理地址
4. 先检测本地端口是否存在，然后访问 google.com 设置三秒超时

**UI 元素：**
- "自动检测代理"按钮（带加载状态）
- 代理地址输入框（支持手动输入和自动填充）
- 代理端口输入框
- 启用/禁用代理的开关（Toggle Switch）

#### 2.2 代理测速功能
**前置条件验证流程：**
1. **检查 ACE Token**：
   - 如果未填写，显示错误提示："请先配置 ACE Token"，并高亮 Token 输入框
2. **检查租户地址（Tenant URL）**：
   - 如果未填写，显示错误提示："请先配置租户地址"，并高亮租户地址输入框
3. **检查已索引项目**：
   - 查询当前已索引的项目列表
   - 如果列表为空，弹出确认对话框："测速功能需要至少一个已索引的项目。是否现在添加项目并开始索引？"
     - 用户选择"是"：打开"添加项目"弹窗，引导用户添加项目并开始索引，索引完成后自动开始测速
     - 用户选择"否"：取消测速操作

**测试配置界面：**
- **测试项目选择器**：
  - 弹窗形式展示已索引项目列表
  - 显示项目名称、索引时间、文件数量
  - 支持单选或多选（用于对比测试）
- **测试查询输入框**：
  - 提示文本："请输入测试搜索关键词（例如：函数定义、类名、变量名等）"
  - 支持多个测试查询（用于更全面的性能评估）
- **测试模式选择**：
  - 仅测试代理模式
  - 仅测试直连模式
  - 对比测试（同时测试代理和直连，展示性能差异）

**测试指标定义：**
1. **单文件上传耗时**：
   - 从选定项目中随机选择一个文件（或指定大小范围的文件）
   - 测量从发起上传请求到收到成功响应的总耗时（毫秒）
2. **项目上传耗时**：
   - 测量上传整个项目所有文件的总耗时（毫秒）
   - 显示文件数量和总大小
3. **语义搜索耗时**：
   - 使用用户输入的测试查询进行语义搜索
   - 测量从发起搜索请求到收到搜索结果的总耗时（毫秒）
4. **网络延迟（Ping）**：
   - 测量到 ACE 服务器的往返时间（RTT）
   - 执行多次测试取平均值
5. **成功率**：
   - 计算所有测试请求的成功率（成功次数 / 总次数 × 100%）
   - 记录失败原因（超时、连接错误、认证失败等）

**测试结果展示设计：**
- **展示形式**：卡片式布局，每个测试指标一个卡片
- **卡片内容**：
  - 指标名称和图标
  - 测试结果数值（带单位）
  - 对比数据（如果是对比测试模式）：
    - 代理模式结果 vs 直连模式结果
    - 性能提升/下降百分比（用颜色标识：绿色=提升，红色=下降）
  - 测试时间戳
- **汇总信息**：
  - 推荐建议："根据测试结果，建议[启用/禁用]代理以获得最佳性能"
  - 测试环境信息：代理地址、测试项目名称、测试时间
- **操作按钮**：
  - "重新测试"按钮
  - "导出测试报告"按钮（可选）

### 3. UI/UX 设计要求

**设计原则：**
- **用户体验优先**：以全球顶尖产品经理的视角分析用户行为路径，优化操作流程，减少用户认知负担
- **视觉设计卓越**：以全球顶尖 UI/UX 设计师的视角设计界面，确保信息层次清晰、视觉引导明确
- **风格一致性**：严格保持与现有 SouConfig.vue 页面的主题风格一致（颜色、字体、间距、圆角、阴影等）
- **色彩策略**：
  - 使用柔和的色彩渐变和光影效果
  - 避免高饱和度、高对比度的刺激性颜色
  - 使用语义化颜色：成功=绿色系、警告=黄色系、错误=红色系、信息=蓝色系
- **信息密度平衡**：避免信息过载，使用折叠面板、标签页等方式组织复杂内容

**交互状态设计：**
- **加载状态（Loading）**：
  - 所有异步操作（代理检测、测速、上传、搜索）必须显示加载指示器
  - 使用骨架屏（Skeleton Screen）或旋转加载图标
  - 显示操作进度（如果可计算）："正在上传文件 3/10..."
- **成功状态**：
  - 显示成功图标（✓）和成功消息
  - 使用绿色系视觉反馈
  - 自动消失或提供关闭按钮
- **失败状态**：
  - 显示错误图标（✗）和详细错误信息
  - 使用红色系视觉反馈
  - 提供重试按钮或解决建议
- **禁用状态**：
  - 前置条件未满足时，禁用相关按钮并显示禁用原因的 Tooltip

**响应式设计：**
- 确保在不同屏幕尺寸下布局合理
- 移动端优化（如果适用）

**技术规范：**
- 使用项目中已有的 UI 组件库（查找现有的 Button、Input、Dialog、Card 等组件）
- 使用项目中已有的图标库（查找现有图标资源）
- 遵循项目的 Vue 3 Composition API + TypeScript 代码风格
- 所有变量、函数、接口、类型都必须有明确的 TypeScript 类型定义
- 使用 `ref`、`reactive`、`computed` 等响应式 API
- 代码结构清晰，逻辑分离（使用 composables 或 utils 提取复用逻辑）
- 添加必要的中文注释，解释复杂逻辑和业务规则

## 执行流程要求

**严格按照 AURA-X-KYS 协议执行：**

### 阶段 1：深度信息收集
使用 `sou` (codebase-retrieval) 工具进行全面的代码库分析，收集以下信息：

1. **当前文件分析**：
   - `src/frontend/components/tools/SouConfig.vue` 的完整实现（组件结构、数据模型、方法、样式）
   - 现有的配置项和数据结构
   - 现有的 UI 组件和布局方式

2. **ACE 接口调用分析**：
   - 查找所有 ACE 接口调用的位置（文件上传、项目上传、语义搜索）
   - 分析网络请求的封装方式（axios、fetch 或其他 HTTP 客户端）
   - 查找现有的请求拦截器或配置逻辑

3. **代理配置模式分析**：
   - 查找项目中是否已有代理配置的实现（其他工具或全局配置）
   - 分析配置持久化的方式（localStorage、配置文件、数据库等）
   - 查找相关的类型定义和接口

4. **UI 组件库和样式系统分析**：
   - 查找项目中已有的 UI 组件（Button、Input、Dialog、Card、Switch、Skeleton 等）
   - 分析现有的样式系统（CSS Modules、Scoped CSS、Tailwind CSS 等）
   - 查找图标库的使用方式
   - 分析现有页面的主题色、字体、间距等设计规范

5. **项目索引管理分析**：
   - 查找项目索引的数据结构和存储方式
   - 查找获取已索引项目列表的方法
   - 查找添加项目和开始索引的流程

6. **类型定义分析**：
   - 查找所有相关的 TypeScript 接口和类型定义
   - 分析现有的类型组织方式

### 阶段 2：方案设计与展示
使用 `三术` MCP (`zhi`) 工具向用户展示详细的技术方案，包括：

1. **代理配置数据结构设计**：
   - TypeScript 接口定义
   - 配置项字段说明
   - 持久化存储方案

2. **代理检测实现方案**：
   - 检测算法流程图
   - 端口列表和优先级
   - 错误处理策略

3. **测速功能架构设计**：
   - 测试流程图
   - 测试指标计算方法
   - 结果数据结构

4. **UI 布局和交互流程设计**：
   - 组件层级结构
   - 页面布局草图（文字描述或 ASCII 图）
   - 用户操作流程图
   - 状态管理方案

5. **需要修改的文件清单**：
   - 列出所有需要修改或新建的文件
   - 说明每个文件的修改内容和原因

6. **基于 KISS/YAGNI/SOLID 原则的方案评估**：
   - **KISS（保持简单）**：方案是否足够简单，避免过度设计
   - **YAGNI（你不会需要它）**：是否只实现当前需要的功能，避免预测性开发
   - **SOLID 原则**：代码结构是否符合单一职责、开闭原则等
   - 方案的优点和潜在风险
   - 推荐的最佳方案（如果有多个备选方案）

### 阶段 3：方案确认
通过 `三术` MCP (`zhi`) 获得用户对技术方案的最终确认：
- 展示完整方案摘要
- 询问用户是否同意该方案
- 如果用户有修改意见，返回阶段 2 进行调整
- 只有在用户明确确认后，才进入实现阶段

### 阶段 4：代码实现
仅在方案确认后开始具体代码实现：
- 严格遵循确认的技术方案
- 按照文件清单逐一实现
- 确保代码质量和类型安全
- 添加必要的中文注释

## 约束条件（不可覆盖）
- ❌ 不生成总结性 Markdown 文档
- ❌ 不生成测试脚本
- ❌ 不编译代码（用户自行编译）
- ❌ 不运行代码（用户自行运行）
- ✅ 所有代码注释使用中文
- ✅ 遵循项目现有的代码风格和规范

## 执行起点
**请立即开始执行阶段，多使用 三术 `sou` 工具进行深度信息收集进行分析，然后通过 `三术` MCP (`zhi`) 展示详细的分析结果和技术方案，最后在确认技术方案后再进行具体实现。**